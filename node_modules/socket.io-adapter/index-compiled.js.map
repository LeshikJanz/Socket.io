{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar Emitter = require('events').EventEmitter;\nvar parser = require('socket.io-parser');\n\n/**\n * Module exports.\n */\n\nmodule.exports = Adapter;\n\n/**\n * Memory adapter constructor.\n *\n * @param {Namespace} nsp\n * @api public\n */\n\nfunction Adapter(nsp){\n  this.nsp = nsp;\n  this.rooms = {};\n  this.sids = {};\n  this.encoder = new parser.Encoder();\n}\n\n/**\n * Inherits from `EventEmitter`.\n */\n\nAdapter.prototype.__proto__ = Emitter.prototype;\n\n/**\n * Adds a socket to a room.\n *\n * @param {String} socket id\n * @param {String} room name\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.add = function(id, room, fn){\n  this.sids[id] = this.sids[id] || {};\n  this.sids[id][room] = true;\n  this.rooms[room] = this.rooms[room] || Room();\n  this.rooms[room].add(id);\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Removes a socket from a room.\n *\n * @param {String} socket id\n * @param {String} room name\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.del = function(id, room, fn){\n  this.sids[id] = this.sids[id] || {};\n  delete this.sids[id][room];\n  if (this.rooms.hasOwnProperty(room)) {\n    this.rooms[room].del(id);\n    if (this.rooms[room].length === 0) delete this.rooms[room];\n  }\n\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Removes a socket from all rooms it's joined.\n *\n * @param {String} socket id\n * @param {Function} callback\n * @api public\n */\n\nAdapter.prototype.delAll = function(id, fn){\n  var rooms = this.sids[id];\n  if (rooms) {\n    for (var room in rooms) {\n      if (this.rooms.hasOwnProperty(room)) {\n        this.rooms[room].del(id);\n        if (this.rooms[room].length === 0) delete this.rooms[room];\n      }\n    }\n  }\n  delete this.sids[id];\n\n  if (fn) process.nextTick(fn.bind(null, null));\n};\n\n/**\n * Broadcasts a packet.\n *\n * Options:\n *  - `flags` {Object} flags for this packet\n *  - `except` {Array} sids that should be excluded\n *  - `rooms` {Array} list of rooms to broadcast to\n *\n * @param {Object} packet object\n * @api public\n */\n\nAdapter.prototype.broadcast = function(packet, opts){\n  var rooms = opts.rooms || [];\n  var except = opts.except || [];\n  var flags = opts.flags || {};\n  var packetOpts = {\n    preEncoded: true,\n    volatile: flags.volatile,\n    compress: flags.compress\n  };\n  var ids = {};\n  var self = this;\n  var socket;\n\n  packet.nsp = this.nsp.name;\n  this.encoder.encode(packet, function(encodedPackets) {\n    if (rooms.length) {\n      for (var i = 0; i < rooms.length; i++) {\n        var room = self.rooms[rooms[i]];\n        if (!room) continue;\n        var sockets = room.sockets;\n        for (var id in sockets) {\n          if (sockets.hasOwnProperty(id)) {\n            if (ids[id] || ~except.indexOf(id)) continue;\n            socket = self.nsp.connected[id];\n            if (socket) {\n              socket.packet(encodedPackets, packetOpts);\n              ids[id] = true;\n            }\n          }\n        }\n      }\n    } else {\n      for (var id in self.sids) {\n        if (self.sids.hasOwnProperty(id)) {\n          if (~except.indexOf(id)) continue;\n          socket = self.nsp.connected[id];\n          if (socket) socket.packet(encodedPackets, packetOpts);\n        }\n      }\n    }\n  });\n};\n\n/**\n * Gets a list of clients by sid.\n *\n * @param {Array} explicit set of rooms to check.\n * @api public\n */\n\nAdapter.prototype.clients = function(rooms, fn){\n  if ('function' == typeof rooms){\n    fn = rooms;\n    rooms = null;\n  }\n\n  rooms = rooms || [];\n\n  var ids = {};\n  var self = this;\n  var sids = [];\n  var socket;\n\n  if (rooms.length) {\n    for (var i = 0; i < rooms.length; i++) {\n      var room = self.rooms[rooms[i]];\n      if (!room) continue;\n      var sockets = room.sockets;\n      for (var id in sockets) {\n        if (sockets.hasOwnProperty(id)) {\n          if (ids[id]) continue;\n          socket = self.nsp.connected[id];\n          if (socket) {\n            sids.push(id);\n            ids[id] = true;\n          }\n        }\n      }\n    }\n  } else {\n    for (var id in self.sids) {\n      if (self.sids.hasOwnProperty(id)) {\n        socket = self.nsp.connected[id];\n        if (socket) sids.push(id);\n      }\n    }\n  }\n\n  if (fn) process.nextTick(fn.bind(null, null, sids));\n};\n\n/**\n* Room constructor.\n*\n* @api private\n*/\n\nfunction Room(){\n  if (!(this instanceof Room)) return new Room();\n  this.sockets = {};\n  this.length = 0;\n}\n\n/**\n * Adds a socket to a room.\n *\n * @param {String} socket id\n * @api private\n */\n\nRoom.prototype.add = function(id){\n  if (!this.sockets.hasOwnProperty(id)) {\n    this.sockets[id] = true;\n    this.length++;\n  }\n};\n\n/**\n * Removes a socket from a room.\n *\n * @param {String} socket id\n * @api private\n */\n\nRoom.prototype.del = function(id){\n  if (this.sockets.hasOwnProperty(id)) {\n    delete this.sockets[id];\n    this.length--;\n  }\n};\n"]}