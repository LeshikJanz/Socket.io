{"version":3,"sources":["namespace.js"],"names":[],"mappings":"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","file":"namespace-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar Socket = require('./socket');\nvar Emitter = require('events').EventEmitter;\nvar parser = require('socket.io-parser');\nvar debug = require('debug')('socket.io:namespace');\nvar hasBin = require('has-binary');\n\n/**\n * Module exports.\n */\n\nmodule.exports = exports = Namespace;\n\n/**\n * Blacklisted events.\n */\n\nexports.events = [\n  'connect',    // for symmetry with client\n  'connection',\n  'newListener'\n];\n\n/**\n * Flags.\n */\n\nexports.flags = [\n  'json',\n  'volatile'\n];\n\n/**\n * `EventEmitter#emit` reference.\n */\n\nvar emit = Emitter.prototype.emit;\n\n/**\n * Namespace constructor.\n *\n * @param {Server} server instance\n * @param {Socket} name\n * @api private\n */\n\nfunction Namespace(server, name){\n  this.name = name;\n  this.server = server;\n  this.sockets = {};\n  this.connected = {};\n  this.fns = [];\n  this.ids = 0;\n  this.initAdapter();\n}\n\n/**\n * Inherits from `EventEmitter`.\n */\n\nNamespace.prototype.__proto__ = Emitter.prototype;\n\n/**\n * Apply flags from `Socket`.\n */\n\nexports.flags.forEach(function(flag){\n  Namespace.prototype.__defineGetter__(flag, function(){\n    this.flags = this.flags || {};\n    this.flags[flag] = true;\n    return this;\n  });\n});\n\n/**\n * Initializes the `Adapter` for this nsp.\n * Run upon changing adapter by `Server#adapter`\n * in addition to the constructor.\n *\n * @api private\n */\n\nNamespace.prototype.initAdapter = function(){\n  this.adapter = new (this.server.adapter())(this);\n};\n\n/**\n * Sets up namespace middleware.\n *\n * @return {Namespace} self\n * @api public\n */\n\nNamespace.prototype.use = function(fn){\n  this.fns.push(fn);\n  return this;\n};\n\n/**\n * Executes the middleware for an incoming client.\n *\n * @param {Socket} socket that will get added\n * @param {Function} fn last fn call in the middleware\n * @api private\n */\n\nNamespace.prototype.run = function(socket, fn){\n  var fns = this.fns.slice(0);\n  if (!fns.length) return fn(null);\n\n  function run(i){\n    fns[i](socket, function(err){\n      // upon error, short-circuit\n      if (err) return fn(err);\n\n      // if no middleware left, summon callback\n      if (!fns[i + 1]) return fn(null);\n\n      // go on to next\n      run(i + 1);\n    });\n  }\n\n  run(0);\n};\n\n/**\n * Targets a room when emitting.\n *\n * @param {String} name\n * @return {Namespace} self\n * @api public\n */\n\nNamespace.prototype.to =\nNamespace.prototype['in'] = function(name){\n  this.rooms = this.rooms || [];\n  if (!~this.rooms.indexOf(name)) this.rooms.push(name);\n  return this;\n};\n\n/**\n * Adds a new client.\n *\n * @return {Socket}\n * @api private\n */\n\nNamespace.prototype.add = function(client, query, fn){\n  debug('adding socket to nsp %s', this.name);\n  var socket = new Socket(this, client, query);\n  var self = this;\n  this.run(socket, function(err){\n    process.nextTick(function(){\n      if ('open' == client.conn.readyState) {\n        if (err) return socket.error(err.data || err.message);\n\n        // track socket\n        self.sockets[socket.id] = socket;\n\n        // it's paramount that the internal `onconnect` logic\n        // fires before user-set events to prevent state order\n        // violations (such as a disconnection before the connection\n        // logic is complete)\n        socket.onconnect();\n        if (fn) fn();\n\n        // fire user-set events\n        self.emit('connect', socket);\n        self.emit('connection', socket);\n      } else {\n        debug('next called after client was closed - ignoring socket');\n      }\n    });\n  });\n  return socket;\n};\n\n/**\n * Removes a client. Called by each `Socket`.\n *\n * @api private\n */\n\nNamespace.prototype.remove = function(socket){\n  if (this.sockets.hasOwnProperty(socket.id)) {\n    delete this.sockets[socket.id];\n  } else {\n    debug('ignoring remove for %s', socket.id);\n  }\n};\n\n/**\n * Emits to all clients.\n *\n * @return {Namespace} self\n * @api public\n */\n\nNamespace.prototype.emit = function(ev){\n  if (~exports.events.indexOf(ev)) {\n    emit.apply(this, arguments);\n  } else {\n    // set up packet object\n    var args = Array.prototype.slice.call(arguments);\n    var parserType = parser.EVENT; // default\n    if (hasBin(args)) { parserType = parser.BINARY_EVENT; } // binary\n\n    var packet = { type: parserType, data: args };\n\n    if ('function' == typeof args[args.length - 1]) {\n      throw new Error('Callbacks are not supported when broadcasting');\n    }\n\n    this.adapter.broadcast(packet, {\n      rooms: this.rooms,\n      flags: this.flags\n    });\n\n    delete this.rooms;\n    delete this.flags;\n  }\n  return this;\n};\n\n/**\n * Sends a `message` event to all clients.\n *\n * @return {Namespace} self\n * @api public\n */\n\nNamespace.prototype.send =\nNamespace.prototype.write = function(){\n  var args = Array.prototype.slice.call(arguments);\n  args.unshift('message');\n  this.emit.apply(this, args);\n  return this;\n};\n\n/**\n * Gets a list of clients.\n *\n * @return {Namespace} self\n * @api public\n */\n\nNamespace.prototype.clients = function(fn){\n  this.adapter.clients(this.rooms, fn);\n  // delete rooms flag for scenario:\n  // .in('room').clients() (GH-1978)\n  delete this.rooms;\n  return this;\n};\n\n/**\n * Sets the compress flag.\n *\n * @param {Boolean} compress if `true`, compresses the sending data\n * @return {Socket} self\n * @api public\n */\n\nNamespace.prototype.compress = function(compress){\n  this.flags = this.flags || {};\n  this.flags.compress = compress;\n  return this;\n};\n"]}