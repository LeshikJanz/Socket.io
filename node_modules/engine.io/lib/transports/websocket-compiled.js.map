{"version":3,"sources":["websocket.js"],"names":[],"mappings":"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","file":"websocket-compiled.js","sourcesContent":["\n/**\n * Module dependencies.\n */\n\nvar Transport = require('../transport')\n  , parser = require('engine.io-parser')\n  , debug = require('debug')('engine:ws')\n\n/**\n * Export the constructor.\n */\n\nmodule.exports = WebSocket;\n\n/**\n * WebSocket transport \n *\n * @param {http.ServerRequest}\n * @api public\n */\n\nfunction WebSocket (req) {\n  Transport.call(this, req);\n  var self = this;\n  this.socket = req.websocket;\n  this.socket.on('message', this.onData.bind(this));\n  this.socket.once('close', this.onClose.bind(this));\n  this.socket.on('error', this.onError.bind(this));\n  this.socket.on('headers', function (headers) {\n    self.emit('headers', headers);\n  });\n  this.writable = true;\n  this.perMessageDeflate = null;\n};\n\n/**\n * Inherits from Transport.\n */\n\nWebSocket.prototype.__proto__ = Transport.prototype;\n\n/**\n * Transport name\n *\n * @api public\n */\n\nWebSocket.prototype.name = 'websocket';\n\n/**\n * Advertise upgrade support.\n *\n * @api public\n */\n\nWebSocket.prototype.handlesUpgrades = true;\n\n/**\n * Advertise framing support.\n *\n * @api public\n */\n\nWebSocket.prototype.supportsFraming = true;\n\n/**\n * Processes the incoming data.\n *\n * @param {String} encoded packet\n * @api private\n */\n\nWebSocket.prototype.onData = function (data) {\n  debug('received \"%s\"', data);\n  Transport.prototype.onData.call(this, data);\n};\n\n/**\n * Writes a packet payload.\n *\n * @param {Array} packets\n * @api private\n */\n\nWebSocket.prototype.send = function (packets) {\n  var self = this;\n  packets.forEach(function(packet) {\n    parser.encodePacket(packet, self.supportsBinary, function(data) {\n      debug('writing \"%s\"', data);\n\n      // always creates a new object since ws modifies it\n      var opts = {};\n      if (packet.options) {\n        opts.compress = packet.options.compress;\n      }\n\n      if (self.perMessageDeflate) {\n        var len = 'string' == typeof data ? Buffer.byteLength(data) : data.length;\n        if (len < self.perMessageDeflate.threshold) {\n          opts.compress = false;\n        }\n      }\n\n      self.writable = false;\n      self.socket.send(data, opts, function (err){\n        if (err) return self.onError('write error', err.stack);\n        self.writable = true;\n        self.emit('drain');\n      });\n    });\n  });\n};\n\n/**\n * Closes the transport.\n *\n * @api private\n */\n\nWebSocket.prototype.doClose = function (fn) {\n  debug('closing');\n  this.socket.close();\n  fn && fn();\n};\n"]}